"""
Academic Figures - Common Configuration
Generated by academic-figures skill

This module provides the standard configuration for generating
publication-ready academic figures with grayscale styling and
Chinese font support.
"""

import matplotlib.pyplot as plt
import matplotlib as mpl
import numpy as np

# ============================================================================
# Font Configuration
# ============================================================================

# Chinese font fallback chain (tested on macOS)
CHINESE_FONTS = ['STFangsong', 'SimSun', 'PingFang SC', 'SimHei']

plt.rcParams['font.sans-serif'] = CHINESE_FONTS
plt.rcParams['font.family'] = 'sans-serif'
plt.rcParams['axes.unicode_minus'] = False  # Fix minus sign display

# ============================================================================
# Color Palette (Grayscale)
# ============================================================================

ACADEMIC_COLORS = [
    '#000000',  # Black
    '#4D4D4D',  # Dark gray
    '#7F7F7F',  # Medium gray
    '#B2B2B2',  # Light gray
    '#D9D9D9',  # Very light gray
]

ACADEMIC_LINESTYLES = ['-', '--', ':', '-.']
ACADEMIC_MARKERS = ['o', 's', '^', 'D', 'v']
ACADEMIC_HATCHES = ['', '///', '...', 'xxx', '\\\\\\']

# ============================================================================
# Academic Style Settings
# ============================================================================

def setup_academic_style():
    """Apply academic publication style to matplotlib figures."""
    mpl.rcParams.update({
        # Font
        'font.size': 11,

        # Axes
        'axes.linewidth': 0.8,
        'axes.edgecolor': 'black',
        'axes.labelweight': 'bold',
        'axes.spines.top': False,
        'axes.spines.right': False,

        # Grid
        'axes.grid': True,
        'grid.alpha': 0.3,
        'grid.linewidth': 0.5,
        'grid.linestyle': '--',

        # Legend
        'legend.frameon': False,
        'legend.loc': 'best',

        # Figure
        'figure.dpi': 150,
        'figure.facecolor': 'white',

        # Saving
        'savefig.dpi': 300,
        'savefig.bbox': 'tight',
        'savefig.pad_inches': 0.1,
        'savefig.facecolor': 'white',
        'savefig.edgecolor': 'none',
    })

# Apply style on import
setup_academic_style()

# ============================================================================
# Utility Functions
# ============================================================================

def get_color(index):
    """Get color from academic palette by index (cycles)."""
    return ACADEMIC_COLORS[index % len(ACADEMIC_COLORS)]

def get_linestyle(index):
    """Get line style by index (cycles)."""
    return ACADEMIC_LINESTYLES[index % len(ACADEMIC_LINESTYLES)]

def get_marker(index):
    """Get marker by index (cycles)."""
    return ACADEMIC_MARKERS[index % len(ACADEMIC_MARKERS)]

def get_hatch(index):
    """Get hatch pattern by index (cycles)."""
    return ACADEMIC_HATCHES[index % len(ACADEMIC_HATCHES)]

def create_figure(width=6, height=4):
    """Create a figure with academic styling."""
    fig, ax = plt.subplots(figsize=(width, height))
    return fig, ax

def save_figure(fig, output_path, formats=None):
    """Save figure in multiple formats."""
    from pathlib import Path

    if formats is None:
        formats = ['pdf', 'png']

    output_path = Path(output_path)
    output_path.parent.mkdir(parents=True, exist_ok=True)

    saved_files = []
    for fmt in formats:
        filepath = f"{output_path}.{fmt}"
        fig.savefig(filepath)
        saved_files.append(filepath)
        print(f"Saved: {filepath}")

    return saved_files
